<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Guide to SuperCollider Unit Testing &#8212; SuperCollider Wiki  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=7d9986eb" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The wiki-wiki" href="../The-wiki-wiki.html" />
    <link rel="prev" title="Setting up your development environment" href="Setting-up-your-development-environment.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="guide-to-supercollider-unit-testing">
<h1>Guide to SuperCollider Unit Testing<a class="headerlink" href="#guide-to-supercollider-unit-testing" title="Link to this heading">¶</a></h1>
<p><em>This document is a work in progress!</em> Feel free to question it and suggest improvements. The document’s main author is Brian Heim (&#64;brianlheim).</p>
<nav class="contents local" id="content">
<p class="topic-title">Content</p>
<ul class="simple">
<li><p><a class="reference internal" href="#running-the-test-suite" id="id1">Running the Test Suite</a></p>
<ul>
<li><p><a class="reference internal" href="#class-library-tests" id="id2">Class Library Tests</a></p></li>
<li><p><a class="reference internal" href="#other-tests" id="id3">Other Tests</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#purpose" id="id4">Purpose</a></p></li>
<li><p><a class="reference internal" href="#what-is-testing" id="id5">What is testing?</a></p></li>
<li><p><a class="reference internal" href="#testing-terminology" id="id6">Testing terminology</a></p>
<ul>
<li><p><a class="reference internal" href="#types-of-tests" id="id7">Types of tests</a></p></li>
<li><p><a class="reference internal" href="#black-box-and-white-box-testing" id="id8">Black-box and white-box testing</a></p></li>
<li><p><a class="reference internal" href="#test-suites" id="id9">Test suites</a></p></li>
<li><p><a class="reference internal" href="#mock-objects" id="id10">Mock objects</a></p></li>
<li><p><a class="reference internal" href="#test-driven-development-red-green-testing" id="id11">Test-driven development (red/green testing)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-unittest-class" id="id12">The UnitTest class</a></p></li>
<li><p><a class="reference internal" href="#unit-testing-guidelines" id="id13">Unit testing guidelines</a></p>
<ul>
<li><p><a class="reference internal" href="#tests-should-be-independent" id="id14">Tests should be independent</a></p></li>
<li><p><a class="reference internal" href="#tests-should-have-exactly-one-assertion" id="id15">Tests should have exactly one assertion</a></p></li>
<li><p><a class="reference internal" href="#avoid-grouping-conditions-in-asserts" id="id16">Avoid grouping conditions in asserts</a></p></li>
<li><p><a class="reference internal" href="#prefer-assertequals-to-assert" id="id17">Prefer assertEquals to assert</a></p></li>
<li><p><a class="reference internal" href="#test-only-what-you-need" id="id18">Test only what you need</a></p></li>
<li><p><a class="reference internal" href="#test-for-common-mistakes" id="id19">Test for common mistakes</a></p></li>
<li><p><a class="reference internal" href="#use-test-cases-that-are-easy-to-check-manually" id="id20">Use test cases that are easy to check manually</a></p></li>
<li><p><a class="reference internal" href="#automate-everything" id="id21">Automate everything</a></p></li>
<li><p><a class="reference internal" href="#tests-should-be-repeatable" id="id22">Tests should be repeatable</a></p></li>
<li><p><a class="reference internal" href="#tests-should-be-thorough" id="id23">Tests should be thorough</a></p></li>
<li><p><a class="reference internal" href="#naming-test-methods" id="id24">Naming test methods</a></p></li>
<li><p><a class="reference internal" href="#write-the-test-first" id="id25">Write the test first</a></p></li>
<li><p><a class="reference internal" href="#the-arrange-act-assert-approach" id="id26">The arrange-act-assert approach</a></p></li>
<li><p><a class="reference internal" href="#avoid-excessive-boilerplate" id="id27">Avoid excessive boilerplate</a></p></li>
<li><p><a class="reference internal" href="#but-some-boilerplate-is-okay" id="id28">But, some boilerplate is okay</a></p></li>
<li><p><a class="reference internal" href="#write-testable-code" id="id29">Write testable code</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#scclasslibrary-testing-standards" id="id30">SCClassLibrary testing standards</a></p>
<ul>
<li><p><a class="reference internal" href="#one-class-per-file" id="id31">One class per file</a></p></li>
<li><p><a class="reference internal" href="#testing-one-class-in-multiple-files" id="id32">Testing one class in multiple files</a></p></li>
<li><p><a class="reference internal" href="#using-external-datasets" id="id33">Using external datasets</a></p></li>
<li><p><a class="reference internal" href="#naming" id="id34">Naming</a></p></li>
<li><p><a class="reference internal" href="#avoid-using-the-default-server" id="id35">Avoid using the default server</a></p></li>
<li><p><a class="reference internal" href="#use-server-bootsync-to-boot-a-server" id="id36">Use <code class="docutils literal notranslate"><span class="pre">Server:-bootSync</span></code> to boot a <code class="docutils literal notranslate"><span class="pre">Server</span></code></a></p></li>
<li><p><a class="reference internal" href="#avoid-use-of-wait" id="id37">Avoid use of <code class="docutils literal notranslate"><span class="pre">wait</span></code></a></p></li>
<li><p><a class="reference internal" href="#avoid-using-class-variables" id="id38">Avoid using class variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-tests-to-the-scclasslibrary-test-suite" id="id39">Adding tests to the SCClassLibrary test suite</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id40">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#a-simple-test" id="id41">A simple test</a></p></li>
<li><p><a class="reference internal" href="#a-more-complex-test" id="id42">A more complex test</a></p></li>
<li><p><a class="reference internal" href="#a-test-using-randomness" id="id43">A test using randomness</a></p></li>
<li><p><a class="reference internal" href="#a-test-using-a-server" id="id44">A test using a server</a></p></li>
<li><p><a class="reference internal" href="#a-test-using-condition-variables" id="id45">A test using condition variables</a></p></li>
<li><p><a class="reference internal" href="#a-test-using-an-external-dataset" id="id46">A test using an external dataset</a></p></li>
<li><p><a class="reference internal" href="#a-test-using-setup-and-teardown" id="id47">A test using <code class="docutils literal notranslate"><span class="pre">setUp</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#continuous-automatic-red-green-testing-via-guard-sclang" id="id48">Continuous automatic red/green testing via guard-sclang</a></p></li>
<li><p><a class="reference internal" href="#resources" id="id49">Resources</a></p></li>
</ul>
</nav>
<section id="running-the-test-suite">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Running the Test Suite</a><a class="headerlink" href="#running-the-test-suite" title="Link to this heading">¶</a></h2>
<section id="class-library-tests">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Class Library Tests</a><a class="headerlink" href="#class-library-tests" title="Link to this heading">¶</a></h3>
<p>If developing on a version older than 3.9.0, download <code class="docutils literal notranslate"><span class="pre">UnitTesting</span></code> quark separately. Since 3.9, UnitTesting is bundled with SC.</p>
<p>The bundled test suite is not added to your SuperCollider compile path by default.</p>
<p>To run the tests you must first add the <code class="docutils literal notranslate"><span class="pre">testsuite</span></code> folder, from the main SuperCollider source tree, to your SuperCollider compile paths. Recompile. Run <code class="docutils literal notranslate"><span class="pre">UnitTest.runAll</span></code>, or run specific tests from the GUI via <code class="docutils literal notranslate"><span class="pre">UnitTest.gui</span></code>.</p>
<p>There are several ways to add to the compile path.
For example:</p>
<ul class="simple">
<li><p>You could add it with the IDE from (Edit) Preferences &gt; Intepreter &gt; Include (+).</p></li>
<li><p>Or edit your active configuration file (by default: <code class="docutils literal notranslate"><span class="pre">sclang_conf.yaml</span></code> found in the User Support Directory)</p></li>
</ul>
</section>
<section id="other-tests">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Other Tests</a><a class="headerlink" href="#other-tests" title="Link to this heading">¶</a></h3>
<p>This project also has small test suites for scsynth and supernova written in C++ using Boost.Test, and a few older tests for sclang written in sclang. To run them, build the project and then run <code class="docutils literal notranslate"><span class="pre">ctest</span></code> in the build directory. If you are using a multi-configuration generator with CMake such as Xcode or Visual Studio, you should also pass the configuration with <code class="docutils literal notranslate"><span class="pre">-C</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-C</span> <span class="pre">Debug</span></code>.</p>
</section>
</section>
<section id="purpose">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Purpose</a><a class="headerlink" href="#purpose" title="Link to this heading">¶</a></h2>
<p>This guide is meant for SuperCollider users as well as developers working on the SuperCollider
project.</p>
<p>The first two sections – “What is testing?” and “Testing terminology” – are meant for those new
to testing. “The UnitTest class” is an introduction to the core unit testing framework in
SuperCollider. “Unit testing guidelines” contains a list of general good-practice guidelines for
writing and maintaining unit tests; “SCClassLibrary testing standards” apply specifically to
maintainers of the SCClassLibrary test suite. In the “Examples” section you will find real-world
excerpts that illustrate common situations encountered while writing tests. Finally, “Resources”
contains links and references for further reading.</p>
</section>
<section id="what-is-testing">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">What is testing?</a><a class="headerlink" href="#what-is-testing" title="Link to this heading">¶</a></h2>
<p>In <em>Clean Code</em>, Steve McConnell writes:</p>
<blockquote>
<div><p>Testing can never completely prove the absence of errors. If you have tested extensively and found
thousands of errors, does it mean that you’ve found all the errors or that you have thousands more
to find? An absence of errors could mean ineffective or incomplete test cases as easily as it
could mean perfect software.</p>
</div></blockquote>
</section>
<section id="testing-terminology">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Testing terminology</a><a class="headerlink" href="#testing-terminology" title="Link to this heading">¶</a></h2>
<section id="types-of-tests">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Types of tests</a><a class="headerlink" href="#types-of-tests" title="Link to this heading">¶</a></h3>
<p>These are names for frequently encountered types of tests and testing approaches:</p>
<p><strong>Unit tests</strong> are small, modular tests that verify a “unit” of code. Examples include verifying
that a multiplication function correctly multiplies 5 and 8, verifying that constructing an object
with some flag set to <code class="docutils literal notranslate"><span class="pre">true</span></code> has the intended effect, and checking that the result of <code class="docutils literal notranslate"><span class="pre">&quot;hello,</span> <span class="pre">&quot;</span> <span class="pre">++</span> <span class="pre">&quot;soundworld&quot;</span></code> is what you expect. These are typically at the heart of a test suite, because they
allow a developer to quickly pinpoint where (and hopefully why) a failure is happening.</p>
<p><strong>Regression tests</strong> are tests that ensure behavior is maintained when a system changes. This type
of test is very similar to unit tests; the main difference is that it typically is written after
(possibly long after) the original code, and serves to record its current behavior, regardless of
whether it fits a particular specification. This is useful because when later changes are made, it
is easy to tell if the behavior has changed in ways that are unexpected.</p>
<p>For example, one of the tests in the SuperCollider test suite checks that the server correctly loads
and plays a <code class="docutils literal notranslate"><span class="pre">SynthDef</span></code>. This <code class="docutils literal notranslate"><span class="pre">SynthDef</span></code> caused an issue at one point during development, so in order
to make sure the same error wasn’t introduced again, we use it as a regression test.</p>
<p><strong>Integration tests</strong> are used to ensure that when two components are combined, they behave as
expected. A good example is testing that when an option is set using <code class="docutils literal notranslate"><span class="pre">ServerOptions</span></code> for a <code class="docutils literal notranslate"><span class="pre">Server</span></code>,
the server program uses the right settings when it boots. Usually these kinds of tests are used in
cases where multiple objects need to interact tightly together.</p>
<p><strong>End-to-end tests</strong> check that the whole pipeline of a larger system works as expected. The purpose
of these tests overlaps with regression and integration testing; the main difference is the scale.</p>
<p>From “The Philosophy of Testing” by Max Kanat-Alexander: “You start up the whole system, perform
some action at the entry point of user input, and check the result that the system produces. You
don’t care about how things work internally to accomplish this goal, you just care about the input
and result. […] End to end tests are valuable, particularly as an initial stopgap for a system
that entirely lacks tests.”</p>
<p><strong>Monkey testing</strong> is a technique that uses randomized input (often in large quantities) to try to
“throw a wrench” in the system. It is important to make sure that if a failure happens, it can be
recorded and repeated (in other words, you should be able to find the wrench after you’ve thrown
it!). This kind of test is also called a <strong>smoke test</strong>.</p>
<p>As you can probably tell, these terms are not strictly defined and usually reflect intent more than
some specific property of the test itself. Understanding the different ways of approaching testing
and using them effectively is a great skill to develop.</p>
</section>
<section id="black-box-and-white-box-testing">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Black-box and white-box testing</a><a class="headerlink" href="#black-box-and-white-box-testing" title="Link to this heading">¶</a></h3>
<p>The term <strong>black-box testing</strong> refers to tests written without any knowledge about what might be
going on inside the method or class being tested; the developer writing the tests only has access to
external information such as the method signature and specifications. <strong>White-box testing</strong>, on the
other hand, refers to testing where the developer has knowledge of the implementation of the
component being tested. Both black-box and white-box testing are valuable: with black-box testing, a
tester might overlook test conditions that would seem obvious if they knew implementation details,
and vice versa for white-box testing.</p>
</section>
<section id="test-suites">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Test suites</a><a class="headerlink" href="#test-suites" title="Link to this heading">¶</a></h3>
<p>A test suite is a set of tests or test suites. At minimum, it is a subclass of <code class="docutils literal notranslate"><span class="pre">UnitTest</span></code> that has
at least one <code class="docutils literal notranslate"><span class="pre">test_</span></code> method. We typically refer to the whole set of tests in the SuperCollider
repository, which contains many test suites itself, as “the test suite.”</p>
</section>
<section id="mock-objects">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Mock objects</a><a class="headerlink" href="#mock-objects" title="Link to this heading">¶</a></h3>
<p>A <strong>mock object</strong> is an object created for the purpose of a test that simulates the behavior of real
objects in enough ways for the test to run. Think of the way engineers use a wind tunnel to test the
aerodynamics of a plane. Typical use cases are testing for an error that is difficult to produce
naturally, testing with an object whose “real” version is too slow, or testing with an object that
would normally provide non-deterministic results. The main goal is to achieve greater isolation for
the test environment.</p>
<p>For more information, see the related <a class="reference external" href="https://en.wikipedia.org/wiki/Mock_object">Wikipedia
article</a>.</p>
</section>
<section id="test-driven-development-red-green-testing">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Test-driven development (red/green testing)</a><a class="headerlink" href="#test-driven-development-red-green-testing" title="Link to this heading">¶</a></h3>
<p><strong>Test-driven development (TDD)</strong> and <strong>red/green testing</strong> refers to a software development
process that emphasizes test-writing as the first and primary action in a development cycle. That
is, tests are written first that do not pass (“red” tests), then code is written until they do pass
(reaching “green” status), at which point the code is refactored and polished. One of the tenets of
this approach is to only write as much as is needed for all tests to pass.</p>
<p>For more information, see the
<a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">Wikipedia article</a>.</p>
</section>
</section>
<section id="the-unittest-class">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">The UnitTest class</a><a class="headerlink" href="#the-unittest-class" title="Link to this heading">¶</a></h2>
<p>See the <code class="docutils literal notranslate"><span class="pre">UnitTest</span></code> help file.</p>
</section>
<section id="unit-testing-guidelines">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Unit testing guidelines</a><a class="headerlink" href="#unit-testing-guidelines" title="Link to this heading">¶</a></h2>
<section id="tests-should-be-independent">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Tests should be independent</a><a class="headerlink" href="#tests-should-be-independent" title="Link to this heading">¶</a></h3>
<p>Sometimes, you want to run a single test by itself; sometimes, only a few tests out of a test suite;
and sometimes, you want to reorder the tests in a suite. Unit tests should be resilient to all of
these possibilities: they should be independent. It should not matter how many tests out of a suite
are run, nor should it matter what order they’re run in. If you need something to happen before or
after a test is run, consider whether it should go in the <strong>setUp</strong> or <strong>tearDown</strong> for that suite.</p>
</section>
<section id="tests-should-have-exactly-one-assertion">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Tests should have exactly one assertion</a><a class="headerlink" href="#tests-should-have-exactly-one-assertion" title="Link to this heading">¶</a></h3>
<p>This might seem a little draconian, and there are certainly times when having multiple assertions in
a test is justified. But, in the vast majority of unit tests, making multiple assertions is a strong
indicator that you are testing more than one “unit” at once, which will make it harder to understand
the purpose of the test when it fails.</p>
<p>Consider a class <code class="docutils literal notranslate"><span class="pre">Bip</span></code> that has a method named <code class="docutils literal notranslate"><span class="pre">udpateFoo</span></code> that sets the <code class="docutils literal notranslate"><span class="pre">foo</span></code> field on the object,
returns <code class="docutils literal notranslate"><span class="pre">foo</span></code>’s old value, and increments a <code class="docutils literal notranslate"><span class="pre">fooUpdateCount</span></code>. There are two ways you could test the
<code class="docutils literal notranslate"><span class="pre">updateFoo</span></code> method. One approach is to test all three effects at once:</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="c1">// in TestBip.sc</span>

<span class="nx">test_updateFoo</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">bip</span> <span class="o">=</span> <span class="nx">Bip</span><span class="p">();</span> <span class="c1">// initial values of foo and fooUpdateCount are 0</span>
	<span class="kd">var</span> <span class="nx">oldFoo</span><span class="p">;</span>

	<span class="nx">oldFoo</span> <span class="o">=</span> <span class="nx">bip</span><span class="p">.</span><span class="nx">updateFoo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">oldFoo</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">bip</span><span class="p">.</span><span class="nx">foo</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">bip</span><span class="p">.</span><span class="nx">fooUpdateCount</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Another approach is to use three separate tests:</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_updateFoo_setsFoo</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">bip</span> <span class="o">=</span> <span class="nx">Bip</span><span class="p">();</span>
	<span class="nx">bip</span><span class="p">.</span><span class="nx">updateFoo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">bip</span><span class="p">.</span><span class="nx">foo</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">test_updateFoo_returnsOldFoo</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">bip</span> <span class="o">=</span> <span class="nx">Bip</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">oldFoo</span> <span class="o">=</span> <span class="nx">bip</span><span class="p">.</span><span class="nx">updateFoo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">oldFoo</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">test_updateFoo_incrementsFooUpdateCount</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">bip</span> <span class="o">=</span> <span class="nx">Bip</span><span class="p">();</span>
	<span class="nx">bip</span><span class="p">.</span><span class="nx">updateFoo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">bip</span><span class="p">.</span><span class="nx">fooUpdateCount</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The second approach requires more lines of code and may take more time to write, but consider what
you gain:</p>
<ul class="simple">
<li><p>The name of each test clearly defines what it is testing. In the case of a failure, reading the
test name alone is enough to tell you what is wrong.</p></li>
<li><p>Furthermore, having clear names means there are no comments required to explain what the test is
doing. This is a good rule of thumb for deciding whether or not your test is well-designed.</p></li>
<li><p>It is easier to check at a glance that each test is correctly written.</p></li>
<li><p>It is easier to maintain. The more complex a block of code is, the more likely it is that errors
will be introduced when attempting to modify it. Similarly, the more complex it is, the longer it
will take for another programmer (perhaps you, several months later) to understand it. Modifying
tests should be fast and easy; sometimes, writing more literal lines of code means that fewer
lines will have to be read and updated later.</p></li>
</ul>
<p>This might seem like a trivial example, but it’s easy to find real-world methods that have several
side effects like this, or are even more complicated.</p>
</section>
<section id="avoid-grouping-conditions-in-asserts">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Avoid grouping conditions in asserts</a><a class="headerlink" href="#avoid-grouping-conditions-in-asserts" title="Link to this heading">¶</a></h3>
<p>It may be tempting to group several conditions together:</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nb">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">bip</span><span class="p">.</span><span class="nx">foo</span> <span class="o">==</span> <span class="mi">3</span> <span class="nx">and</span><span class="o">:</span> <span class="nx">oldFoo</span> <span class="o">==</span> <span class="mi">0</span> <span class="nx">and</span><span class="o">:</span> <span class="nx">bip</span><span class="p">.</span><span class="nx">fooUpdateCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>You should avoid doing this for several reasons:</p>
<ul class="simple">
<li><p>It is more difficult to read.</p></li>
<li><p>It requires use of <code class="docutils literal notranslate"><span class="pre">assert</span></code>, when <code class="docutils literal notranslate"><span class="pre">assertEquals</span></code> would give us more information (see below).</p></li>
<li><p>When the test fails, it will be impossible to tell which of the three conditions are false!</p></li>
</ul>
</section>
<section id="prefer-assertequals-to-assert">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Prefer assertEquals to assert</a><a class="headerlink" href="#prefer-assertequals-to-assert" title="Link to this heading">¶</a></h3>
<p>Wherever possible, prefer using <code class="docutils literal notranslate"><span class="pre">assertEquals</span></code> to <code class="docutils literal notranslate"><span class="pre">assert</span></code>. When you use <code class="docutils literal notranslate"><span class="pre">assertEquals</span></code>, the
automatically generated failure message will give you information about the experimental value and
the expected value. When you use <code class="docutils literal notranslate"><span class="pre">assert</span></code>, you only know that the values were unequal. Therefore,
you can save yourself time spent both writing the assert message and reading the test code by using
<code class="docutils literal notranslate"><span class="pre">assertEquals</span></code>.</p>
<p>The same argument goes for using <code class="docutils literal notranslate"><span class="pre">assertFloatEquals</span></code> over a hand-written <code class="docutils literal notranslate"><span class="pre">assert</span></code> that tests the
same condition. Therefore, this rule could be generalized to: “use the most specific <code class="docutils literal notranslate"><span class="pre">assert</span></code> method
possible”; use of <code class="docutils literal notranslate"><span class="pre">assertEquals</span></code> just happens to be the most frequent situation where it applies.</p>
</section>
<section id="test-only-what-you-need">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Test only what you need</a><a class="headerlink" href="#test-only-what-you-need" title="Link to this heading">¶</a></h3>
<p>If a test wouldn’t tell you anything new about how well a component functions, don’t write it! Not
only do redundant tests require more time to write, they also take more time to run and give a false
sense of security. If you have a test that checks the result of <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code>, there’s no need to write a
second test for <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">+</span> <span class="pre">4</span></code> unless you have some reason to suspect that your addition operation might be
treating those operands differently. A good rule of thumb is: if you can’t easily describe how one
test differs from another, they probably aren’t both necessary. Remember, the goal of writing tests
is to find errors, not to show that code is correct.</p>
</section>
<section id="test-for-common-mistakes">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Test for common mistakes</a><a class="headerlink" href="#test-for-common-mistakes" title="Link to this heading">¶</a></h3>
<p>From <em>Code Complete</em>:</p>
<blockquote>
<div><p>good programmers use a variety of less formal, heuristic techniques to expose errors in this code.
[…] [Error guessing] means creating test cases based upon guesses about where the program
might have errors.</p>
</div></blockquote>
<p>Some good things to test are:</p>
<ul class="simple">
<li><p>boundary cases:</p>
<ul>
<li><p>unique integers like 0, -1, 1, and maximum and minimum integer values</p></li>
<li><p>unique floats like <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (<code class="docutils literal notranslate"><span class="pre">0/0</span></code>), <code class="docutils literal notranslate"><span class="pre">-inf</span></code>, <code class="docutils literal notranslate"><span class="pre">+inf</span></code>, negative and positive large floating-point
numbers, empty strings, strings</p></li>
<li><p>unique strings like the empty string, very long strings, strings with character values in
the ASCII control range (1-31) and non-ASCII range (128-255), and strings will null
characters</p></li>
</ul>
</li>
<li><p>bad data:</p>
<ul>
<li><p>garbage or semirandom input (for example, strings or arrays in an invalid format)</p></li>
<li><p>numbers outside the expected “valid” range</p></li>
<li><p>less data than expected</p></li>
<li><p>more data than expected</p></li>
<li><p>objects with bad or invalid state used as input</p></li>
</ul>
</li>
</ul>
<p>It’s important to consider the specific component being tested and craft your inputs accordingly.
This is the part of testing where you get to be mean to your code!</p>
<p>Testing on these kinds of inputs has the additional benefit of forcing you to think about the
guarantees of the component being tested. Should it ignore bad inputs silently? Post a warning?
Throw an error? Not even test, and put the burden of validation on the caller? Each of this is a
valid design choice depending on the situation; the important point is that it ought to be a
<em>choice</em>, not an afterthought.</p>
</section>
<section id="use-test-cases-that-are-easy-to-check-manually">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Use test cases that are easy to check manually</a><a class="headerlink" href="#use-test-cases-that-are-easy-to-check-manually" title="Link to this heading">¶</a></h3>
<p>Prefer using simple values like <code class="docutils literal notranslate"><span class="pre">&quot;book&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">2000</span></code> as test inputs. Complicated-looking values like
<code class="docutils literal notranslate"><span class="pre">&quot;yzzoinnnpon&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">19645583</span></code> are usually no more likely to discover errors than their visually
simpler counterparts. This makes checking the correctness of a test by hand or by eye easier.</p>
</section>
<section id="automate-everything">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Automate everything</a><a class="headerlink" href="#automate-everything" title="Link to this heading">¶</a></h3>
<p>If a test has to be run manually, it is likely to be run less often than automated tests, perhaps
not even at all. It’s worth it in the long run to make tests automated. If you find it difficult to
automate a particular test, don’t forget that the best solution could be to add code to the
component being tested!</p>
</section>
<section id="tests-should-be-repeatable">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Tests should be repeatable</a><a class="headerlink" href="#tests-should-be-repeatable" title="Link to this heading">¶</a></h3>
<p>Running a test multiple times should only produce a different result when the code being tested is
modified. A test that randomly fails or passes the first time it is run is a hindrance rather than
an aid to testing. So is a test that fails the second or third time it is run. If a test relies on
certain preconditions, it should establish that when it runs, or you should establish it in the
class’s <code class="docutils literal notranslate"><span class="pre">setUp</span></code>.</p>
</section>
<section id="tests-should-be-thorough">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Tests should be thorough</a><a class="headerlink" href="#tests-should-be-thorough" title="Link to this heading">¶</a></h3>
<p>This may seem obvious, but it’s worth saying: tests should cover as much code as is possible and
reasonable. Reaching 100% test coverage is simply not possible or practical for many codebases, but
around 70-80% is healthy. As Kent Beck says in “What Should We Unit Test?”: “Write tests until fear
is transformed into boredom.”</p>
</section>
<section id="naming-test-methods">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Naming test methods</a><a class="headerlink" href="#naming-test-methods" title="Link to this heading">¶</a></h3>
<p>Normally when naming variables and functions, the developer tries to strike a balance of clarity
between specificity and brevity. However, naming test methods clearly often means using more
characters than usual. Some authors recommend the “SSR” (subject-scenario-result) approach. For
example, a method that tests that the <code class="docutils literal notranslate"><span class="pre">onFailure</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">Server.waitForBoot</span></code> actually gets
executed when the server fails to boot might be named:</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_waitForBoot_ifServerFailsToBoot_runsOnFailureParameter</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is the subject (<code class="docutils literal notranslate"><span class="pre">waitForBoot</span></code>), a scenario (“if the server fails to boot”), and the expected
result (“runs the <code class="docutils literal notranslate"><span class="pre">onFailure</span></code> parameter”). Note that each of these elements is separated by an
underscore in the method name.</p>
<p>This approach might seem unnecessarily verbose at first glance, but again, consider that when the
test fails, all you will see initially is the name of the test. Without looking at the test code,
you have a crystal clear diagnosis of the problem; so clear, in fact, that you may not even need to
look at the test code at all. Tests are read and run much more often than they are written, so
investing in a descriptive name while writing unit tests is well worth the effort.</p>
<p>Remember that the name of the test suite is also shared in the test report. This means that if you
have a lot of tests for this method, you can group them all together in a test suite named something
like <code class="docutils literal notranslate"><span class="pre">TestServer_WaitForBoot</span></code>. Then, you don’t have to use the name of the method in the name of
each test; the report of a failure on
<code class="docutils literal notranslate"><span class="pre">TestServer_WaitForBoot:test_ifServerFailsToBoot_runsOnFailureParamter()</span></code> carries the exact same
information.</p>
<p>Whatever approach you use to name your test methods, ensure that they are descriptive and explicit.</p>
</section>
<section id="write-the-test-first">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Write the test first</a><a class="headerlink" href="#write-the-test-first" title="Link to this heading">¶</a></h3>
<p>The reason for this is simple: the test is bound to be written at some point in time, and working on
a fix with a test already written gives you the opportunity to quickly run the test to check a fix.
If you wait until later, you may spend extra time making the solution more complex than it needs to
be.</p>
</section>
<section id="the-arrange-act-assert-approach">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">The arrange-act-assert approach</a><a class="headerlink" href="#the-arrange-act-assert-approach" title="Link to this heading">¶</a></h3>
<p>An elegant and straightforward way to organize your tests is with the arrange-act-assert approach:</p>
<ol class="arabic simple">
<li><p><strong>Arrange</strong> the conditions necessary for the test.</p></li>
<li><p>Perform the <strong>act</strong> whose result you are testing.</p></li>
<li><p><strong>Assert</strong> that the act had the expected consequences.</p></li>
</ol>
<p>Take the dead-simple example of a calculator class:</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="c1">// in TestCalculator.sc</span>

<span class="nx">test_addingTwoNumbers_producesSum</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// Arrange: create a calculator object</span>
	<span class="kd">var</span> <span class="nx">calc</span> <span class="o">=</span> <span class="nx">Calculator</span><span class="p">();</span>

	<span class="c1">// Act: perform the action to be tested (addition)</span>
	<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">calc</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

	<span class="c1">// Assert: check that the addition was performed correctly</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Following this pattern religiously can produce very readable and maintainable test code, because the
flow of logic is clear and natural.</p>
<p>Sometimes, you might need a small “cleanup” section after the assert. For example, creating a server
in a test method requires calling <code class="docutils literal notranslate"><span class="pre">remove</span></code> on it to remove it from the global registry. Code
segments in the “arrange” and “cleanup” parts of a test are excellent candidates for things that
might be better off in the <code class="docutils literal notranslate"><span class="pre">setUp</span></code> or <code class="docutils literal notranslate"><span class="pre">tearDown</span></code> of the test suite.</p>
</section>
<section id="avoid-excessive-boilerplate">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Avoid excessive boilerplate</a><a class="headerlink" href="#avoid-excessive-boilerplate" title="Link to this heading">¶</a></h3>
<p>There are a number of ways to cut down on repeating yourself in test code:</p>
<ul class="simple">
<li><p>Consider moving code into <code class="docutils literal notranslate"><span class="pre">setUp</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown</span></code> for the test suite. If a majority, but not all,
methods in the suite use the same setup and tear-down code, consider whether it might be better to
split the suite into two parts.</p></li>
<li><p>Consider creating a small method for the sole purpose of performing repeated actions. You should
not do this too often, because it has the potential to make test code much harder to understand.</p></li>
<li><p>Consider refactoring the code you’re testing! Code that works is not always written to be testable,
and vice versa. If it’s a pain to use a class or method, the problem might be best remedied by
changing it so that it handles the setup itself or performs fewer tasks. Modularity is a quality
of good interface design.</p></li>
</ul>
</section>
<section id="but-some-boilerplate-is-okay">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">But, some boilerplate is okay</a><a class="headerlink" href="#but-some-boilerplate-is-okay" title="Link to this heading">¶</a></h3>
<p>Avoid the temptation of writing “helper” functions and abstract classes to aid tests. This increases
complexity, which makes your tests harder to understand and more likely to contain errors of their
own. Ideally, another developer should be able to understand what your test is doing without looking
outside the test method itself.</p>
</section>
<section id="write-testable-code">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Write testable code</a><a class="headerlink" href="#write-testable-code" title="Link to this heading">¶</a></h3>
<p>Writing code that can be tested efficiently is a skill worth developing. Writing testable code is
often closely aligned with writing well-designed code in general: methods should be kept small and
focused, complex state should be avoided, and results should be logical and predictable. Writing
tests is a good time to reflect on what could be improved in the design of a method or an object -
if it’s difficult for you to test, chances are it will be difficult for a user to use.</p>
</section>
</section>
<section id="scclasslibrary-testing-standards">
<h2><a class="toc-backref" href="#id30" role="doc-backlink">SCClassLibrary testing standards</a><a class="headerlink" href="#scclasslibrary-testing-standards" title="Link to this heading">¶</a></h2>
<p><em>Note:</em> these guidelines are aspirational. They are not all used in current practice. This guide
takes precedence over anything you might see in the test suite. Changes that bring them into sync
with these guidelines are very welcome!</p>
<section id="one-class-per-file">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">One class per file</a><a class="headerlink" href="#one-class-per-file" title="Link to this heading">¶</a></h3>
<p>Every test class should test methods on exactly one library class. This may make some tests slightly
less intuitive to write - for example, when testing interfaces shared across multiple classes - but
makes organization and maintenance straightforward. Tests on methods for <code class="docutils literal notranslate"><span class="pre">String</span></code> should go in
<code class="docutils literal notranslate"><span class="pre">TestString</span></code>, those for methods on <code class="docutils literal notranslate"><span class="pre">Routine</span></code> should go in <code class="docutils literal notranslate"><span class="pre">TestRoutine</span></code>, and so on. However, if
there are large number of tests to be written, they may be divided across several classes.</p>
</section>
<section id="testing-one-class-in-multiple-files">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Testing one class in multiple files</a><a class="headerlink" href="#testing-one-class-in-multiple-files" title="Link to this heading">¶</a></h3>
<p>If your test file is becoming very large (over 300 lines) or you find yourself writing a lot of
tests for the same method or set of methods, the tests may be broken into several classes according
to the format: <code class="docutils literal notranslate"><span class="pre">TestClass_Method</span></code> or <code class="docutils literal notranslate"><span class="pre">TestClass_Component</span></code>.</p>
</section>
<section id="using-external-datasets">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Using external datasets</a><a class="headerlink" href="#using-external-datasets" title="Link to this heading">¶</a></h3>
<p>If a test requires a large dataset, place it in a separate file in <code class="docutils literal notranslate"><span class="pre">testsuite/classlibrary/data</span></code> and
read it in during the test. This keeps test class source files neat and readable. See “Examples” for
a basic test demonstrating this.</p>
</section>
<section id="naming">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">Naming</a><a class="headerlink" href="#naming" title="Link to this heading">¶</a></h3>
<section id="classes">
<h4>Classes<a class="headerlink" href="#classes" title="Link to this heading">¶</a></h4>
<p>When a class only needs one test class: <code class="docutils literal notranslate"><span class="pre">TestSomeClass</span></code>.</p>
<p>When testing a method or component of a class: <code class="docutils literal notranslate"><span class="pre">TestClass_Method</span></code> and <code class="docutils literal notranslate"><span class="pre">TestClass_Component</span></code>.</p>
<p>Class names should always consist of capitalized words (never <code class="docutils literal notranslate"><span class="pre">TestClass_method</span></code>).</p>
<p>The file should be named to match the name of the class it contains.</p>
</section>
<section id="methods">
<h4>Methods<a class="headerlink" href="#methods" title="Link to this heading">¶</a></h4>
<p>Methods: in general, use SSR <code class="docutils literal notranslate"><span class="pre">test_subject_inSituation_respondsCorrectly()</span></code>. Use names that are
concise but descriptive, and can be reasonably well-understood without looking at the source code.</p>
<p>Spell out numbers.</p>
</section>
<section id="datasets">
<h4>Datasets<a class="headerlink" href="#datasets" title="Link to this heading">¶</a></h4>
<p>The filename should begin with the name of the test class in which it is used, and include a word or
two describing its contents or purpose. If a dataset is used by multiple test classes, the first
part of the name can be ommitted. Examples of dataset names are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TestServer_hugeOSCArray</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TestMyStream_trickyInputSequence</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">complexSynthdef.scsyndef</span></code></p></li>
</ul>
<p>Use a file extension only if the file is in a recognized format (such as <code class="docutils literal notranslate"><span class="pre">.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">.scsyndef</span></code>).
Otherwise, omit the extension.</p>
</section>
</section>
<section id="avoid-using-the-default-server">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">Avoid using the default server</a><a class="headerlink" href="#avoid-using-the-default-server" title="Link to this heading">¶</a></h3>
<p>Don’t use the default server unless your test absolutely depends on the “default” default server
(note that you can make a new server the default server). Tests using a pre-existing server violate
the independence of tests. Instead, prefer creating a new server using either the name of the method
or the name of the class as its name, to avoid name collisions. Make sure to call <code class="docutils literal notranslate"><span class="pre">remove</span></code> on it
when done.</p>
</section>
<section id="use-server-bootsync-to-boot-a-server">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Use <code class="docutils literal notranslate"><span class="pre">Server:-bootSync</span></code> to boot a <code class="docutils literal notranslate"><span class="pre">Server</span></code></a><a class="headerlink" href="#use-server-bootsync-to-boot-a-server" title="Link to this heading">¶</a></h3>
<p>Prefer using this method instead of <code class="docutils literal notranslate"><span class="pre">UnitTest:-bootServer</span></code>.</p>
</section>
<section id="avoid-use-of-wait">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">Avoid use of <code class="docutils literal notranslate"><span class="pre">wait</span></code></a><a class="headerlink" href="#avoid-use-of-wait" title="Link to this heading">¶</a></h3>
<p>Generally, hard-coded delays are bad practice, and should be replaced with waiting or hanging on a
condition. Extra waiting slows down the test suite and introduces the possibility for unexpected
behavior if the sleeping thread wakes up early. If you write <code class="docutils literal notranslate"><span class="pre">1.wait</span></code> in a test, think about why you
need to do so. If there is no way to wait on a true condition, either add code to the system being
tested such that it is possible, or leave an explanatory comment.</p>
</section>
<section id="avoid-using-class-variables">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Avoid using class variables</a><a class="headerlink" href="#avoid-using-class-variables" title="Link to this heading">¶</a></h3>
<p>Use of class variables increases the likelihood of tests becoming unintentionally interdependent.
They also make tests harder to understand, because values are initialized far from where they are
used.</p>
<p>In general, restrict usage of class variables to objects that are constructed and destructed in
<code class="docutils literal notranslate"><span class="pre">setUp</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown</span></code>.</p>
</section>
</section>
<section id="adding-tests-to-the-scclasslibrary-test-suite">
<h2><a class="toc-backref" href="#id39" role="doc-backlink">Adding tests to the SCClassLibrary test suite</a><a class="headerlink" href="#adding-tests-to-the-scclasslibrary-test-suite" title="Link to this heading">¶</a></h2>
<p>It’s easy to get started adding new tests to the SCClassLibrary test suite! The suite is in
<code class="docutils literal notranslate"><span class="pre">testsuite/classlibrary</span></code> in the main repository.</p>
<p>Before starting, you should review the SCClassLibrary test suite guidelines in the previous section
so that your code can be integrated with as few changes as possible.</p>
<p>To add tests:</p>
<ol class="arabic simple">
<li><p>Find the test file for the class you’re testing. You may need to create a new file for this.</p></li>
<li><p>Add new test methods for the conditions you’re testing until you’re satisfied (or bored).</p></li>
<li><p>Run the test class’s unit tests with <code class="docutils literal notranslate"><span class="pre">TestSomeClass.run</span></code> to determine whether they pass.</p></li>
<li><p>Revise the tests until they pass, then submit your changes!</p></li>
</ol>
<p>If you run into any difficulties or have questions, feel free to ask a member of the dev team on
GitHub or email the sc-dev mailing list.</p>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id40" role="doc-backlink">Examples</a><a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<p>These examples are intended as best-practice templates that can adapted easily to a variety of test
situations. Many of them are based on a fictitious <code class="docutils literal notranslate"><span class="pre">Calculator</span></code> class which has all the common
functions of a handheld calculator.</p>
<section id="a-simple-test">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">A simple test</a><a class="headerlink" href="#a-simple-test" title="Link to this heading">¶</a></h3>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="c1">// in TestCalculator.sc</span>

<span class="nx">test_addition_twoPlusThree_isFive</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">calc</span> <span class="o">=</span> <span class="nx">Calculator</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">expected</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

	<span class="nx">calc</span><span class="p">.</span><span class="nx">enterNumber</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="nx">calc</span><span class="p">.</span><span class="nx">enterPlus</span><span class="p">();</span>
	<span class="nx">calc</span><span class="p">.</span><span class="nx">enterNumber</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
	<span class="nx">calc</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>

	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">calc</span><span class="p">.</span><span class="nx">currentResult</span><span class="p">(),</span> <span class="nx">expected</span><span class="p">,</span> <span class="s2">&quot;Addition works&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="a-more-complex-test">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">A more complex test</a><a class="headerlink" href="#a-more-complex-test" title="Link to this heading">¶</a></h3>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_globalLibrary_checkingOutABook_removesBookFromLibrary</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">library</span> <span class="o">=</span> <span class="nx">Library</span><span class="p">.</span><span class="nx">global</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">bookName</span> <span class="o">=</span> <span class="s2">&quot;War and Peace&quot;</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="nx">library</span><span class="p">.</span><span class="nx">checkOut</span><span class="p">(</span><span class="nx">bookName</span><span class="p">);</span>

	<span class="nb">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">library</span><span class="p">.</span><span class="nx">hasBook</span><span class="p">(</span><span class="nx">bookName</span><span class="p">).</span><span class="nx">not</span><span class="p">);</span>

	<span class="nx">library</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="a-test-using-randomness">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">A test using randomness</a><a class="headerlink" href="#a-test-using-randomness" title="Link to this heading">¶</a></h3>
<p>In this test, some string-related method is fed a large number of random strings (a “monkey test” -
see “Testing terminology”) and is expected to return false for all of them.</p>
<p>The main purpose of this example is to demonstrate the correct way to handle randomness in a test:
by using a fixed seed so that the results are deterministic and reproducible. In practice, tests
like this are not needed often, since hand-crafted inputs are often just as good (or even better) at
catching corner cases.</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_someMethod_handlesRandomStrings</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">seed</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">stringSize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

	<span class="nb">thisThread</span><span class="p">.</span><span class="nx">randSeed</span> <span class="o">=</span> <span class="nx">seed</span><span class="p">;</span>

	<span class="nx">n</span><span class="p">.</span><span class="k">do</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">string</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="nx">stringSize</span><span class="p">,</span> <span class="p">{</span>
			<span class="nx">rrand</span><span class="p">(</span><span class="nx">$a</span><span class="p">.</span><span class="nx">ascii</span><span class="p">,</span> <span class="nx">$z</span><span class="p">.</span><span class="nx">ascii</span><span class="p">).</span><span class="nx">asAscii</span>
		<span class="p">};</span>
		<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">someMethod</span><span class="p">();</span>

		<span class="nb">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">not</span><span class="p">,</span> <span class="s2">&quot;Input:&quot;</span> <span class="o">+</span> <span class="nx">string</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="a-test-using-a-server">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">A test using a server</a><a class="headerlink" href="#a-test-using-a-server" title="Link to this heading">¶</a></h3>
<p>This test checks that setting <code class="docutils literal notranslate"><span class="pre">clientID</span></code> on a <code class="docutils literal notranslate"><span class="pre">Server</span></code> object during construction works. It
demonstrates several important points about server-related tests:</p>
<ul class="simple">
<li><p>avoid using the default server</p></li>
<li><p>give the server object a somewhat unique name (in this case, the name of the class serves as
reasonably unique)</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">Server:-bootSync</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quit</span></code> and <code class="docutils literal notranslate"><span class="pre">remove</span></code> the server after use</p></li>
</ul>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_setWithConstructor</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">ServerOptions</span><span class="p">.</span><span class="k">new</span><span class="p">.</span><span class="nx">maxLogins_</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">Server</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="nx">server</span><span class="p">.</span><span class="nx">bootSync</span><span class="p">;</span>
	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">clientID</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;clientID should be settable by Server constructor.&quot;</span><span class="p">);</span>
	<span class="nx">server</span><span class="p">.</span><span class="nx">quit</span><span class="p">;</span>
	<span class="nx">server</span><span class="p">.</span><span class="nx">remove</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="a-test-using-condition-variables">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">A test using condition variables</a><a class="headerlink" href="#a-test-using-condition-variables" title="Link to this heading">¶</a></h3>
<p>In this test, <code class="docutils literal notranslate"><span class="pre">someAsyncMethod</span></code>, a method on <code class="docutils literal notranslate"><span class="pre">SomeAsyncClass</span></code>, is an asynchronous method that
provides a callback parameter. Many asynchronous functions in SuperCollider provide such a
callback mechanism, such as <code class="docutils literal notranslate"><span class="pre">loadToFloatArray</span></code>. The parameter is typically named <code class="docutils literal notranslate"><span class="pre">action</span></code> or
<code class="docutils literal notranslate"><span class="pre">onComplete</span></code>. This test checks that after calling <code class="docutils literal notranslate"><span class="pre">someAsyncMethod</span></code>, the callback function is
eventually run and <code class="docutils literal notranslate"><span class="pre">result</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>. The conventional way to do this is by using a <code class="docutils literal notranslate"><span class="pre">Condition</span></code>
variable to wait for the callback to run, and forking a separate timeout thread in case it fails to
fire.</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_someAsyncMethod_runsCallback</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="nx">SomeAsyncClass</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">cond</span> <span class="o">=</span> <span class="nx">Condition</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="s2">&quot;async input&quot;</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="nx">async</span><span class="p">.</span><span class="nx">someAsyncMethod</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="p">{</span> <span class="o">|</span><span class="nx">i</span><span class="o">|</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span> <span class="nx">cond</span><span class="p">.</span><span class="nx">unhang</span> <span class="p">});</span>
	<span class="nx">fork</span> <span class="p">{</span> <span class="mi">3</span><span class="p">.</span><span class="nx">wait</span><span class="p">;</span> <span class="nx">cond</span><span class="p">.</span><span class="nx">unhang</span> <span class="p">};</span>

	<span class="nx">cond</span><span class="p">.</span><span class="nx">hang</span><span class="p">;</span>

	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="a-test-using-an-external-dataset">
<h3><a class="toc-backref" href="#id46" role="doc-backlink">A test using an external dataset</a><a class="headerlink" href="#a-test-using-an-external-dataset" title="Link to this heading">¶</a></h3>
<p>This shows how to run a test that depends on some external dataset stored as a CSV file in a <code class="docutils literal notranslate"><span class="pre">data</span></code>
directory relative to the test.</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">test_processData_givenSomeData_returnsThree</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">someObj</span> <span class="o">=</span> <span class="nx">SomeClass</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">dataPath</span> <span class="o">=</span> <span class="s2">&quot;data/SomeClass_someData.csv&quot;</span><span class="p">.</span><span class="nx">resolveRelative</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">CSVFileReader</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">dataPath</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">expected</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">got</span> <span class="o">=</span> <span class="nx">someObj</span><span class="p">.</span><span class="nx">processData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

	<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">expected</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Alternatives to using a CSV file format include space-separated (with <code class="docutils literal notranslate"><span class="pre">FileReader</span></code>), tab-separated
(<code class="docutils literal notranslate"><span class="pre">TabFileReader</span></code>), and archived objects created with <code class="docutils literal notranslate"><span class="pre">obj.writeArchive</span></code> (read using
<code class="docutils literal notranslate"><span class="pre">Object:*readArchive</span></code>.</p>
</section>
<section id="a-test-using-setup-and-teardown">
<h3><a class="toc-backref" href="#id47" role="doc-backlink">A test using <code class="docutils literal notranslate"><span class="pre">setUp</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown</span></code></a><a class="headerlink" href="#a-test-using-setup-and-teardown" title="Link to this heading">¶</a></h3>
<p>In this test suite for a fictitious <code class="docutils literal notranslate"><span class="pre">Discotheque</span></code> class, each test method acts on a <code class="docutils literal notranslate"><span class="pre">Discotheque</span></code>
that’s open and playing music. Since repeating this test code in every method would be highly
repetetive and prone to copy-pasting errors, it’s best to use <code class="docutils literal notranslate"><span class="pre">setUp</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown</span></code>.</p>
<div class="highlight-supercollider notranslate"><div class="highlight"><pre><span></span><span class="nx">TestDiscotheque</span> <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">disco</span><span class="p">;</span>

	<span class="nx">setUp</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">disco</span> <span class="o">=</span> <span class="nx">Discotheque</span><span class="p">();</span>
		<span class="nx">disco</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
		<span class="nx">disco</span><span class="p">.</span><span class="nx">playMusic</span><span class="p">(</span><span class="ss">\trance</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nx">tearDown</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">disco</span><span class="p">.</span><span class="nx">stopMusic</span><span class="p">;</span>
		<span class="nx">disco</span><span class="p">.</span><span class="nx">close</span><span class="p">;</span>

		<span class="c1">// while not strictly required, setting class variables to `nil`</span>
		<span class="c1">// after use can help prevent accidental reuse.</span>
		<span class="nx">disco</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">test_emptyDiscotheque_isEmpty</span><span class="p">()</span> <span class="p">{</span>
		<span class="nb">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">disco</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">());</span>
	<span class="p">}</span>

	<span class="nx">test_addGuest_addingOne_numGuestsIsOne</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">disco</span><span class="p">.</span><span class="nx">addGuest</span><span class="p">(</span><span class="ss">\Natalie</span><span class="p">);</span>
		<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">disco</span><span class="p">.</span><span class="nx">numGuests</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nx">test_changeMusic_musicIsChanged</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">disco</span><span class="p">.</span><span class="nx">changeMusic</span><span class="p">(</span><span class="ss">\house</span><span class="p">);</span>
		<span class="nb">this</span><span class="p">.</span><span class="nx">assertEquals</span><span class="p">(</span><span class="nx">disco</span><span class="p">.</span><span class="nx">music</span><span class="p">,</span> <span class="ss">\house</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* etc. */</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="continuous-automatic-red-green-testing-via-guard-sclang">
<h2><a class="toc-backref" href="#id48" role="doc-backlink">Continuous automatic red/green testing via guard-sclang</a><a class="headerlink" href="#continuous-automatic-red-green-testing-via-guard-sclang" title="Link to this heading">¶</a></h2>
<p>Rather than manually running appropriate tests after editing a library class or a <code class="docutils literal notranslate"><span class="pre">UnitTest</span></code> class, you can use
<a class="reference external" href="https://github.com/aspiers/guard-sclang">aspiers/guard-sclang</a> which will watch for file changes and automatically run
tests in reaction to them. Developers are encouraged to use this tool. The steps to set this up are as follows:</p>
<ul class="simple">
<li><p>Make sure you have Ruby installed.</p></li>
<li><p>Make sure you have <a class="reference external" href="http://bundler.io/">Bundler</a> installed (usually this is as simple as running <code class="docutils literal notranslate"><span class="pre">gem</span> <span class="pre">install</span> <span class="pre">bundler</span></code>).</p></li>
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">sclang</span></code> is somewhere on your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">$supercollider_source/tools/guard</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bundle</span> <span class="pre">install</span></code></p></li>
</ul>
<p>Now you should be ready to launch Guard via:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>guard
</pre></div>
</div>
<p>Then start hacking on SuperCollider classes, and enjoy the immediate feedback!</p>
<p>The mapping between implementation classes and test classes is defined in <code class="docutils literal notranslate"><span class="pre">tools/guard/Guardfile</span></code>.  This is currently by
far from perfect, because it naively assumes a 1:1 mapping between class <code class="docutils literal notranslate"><span class="pre">Foo</span></code> and test class <code class="docutils literal notranslate"><span class="pre">TestFoo</span></code>.  However it
should be easy to make it more intelligent, even if you don’t know Ruby; please feel free to contribute improvements!</p>
</section>
<section id="resources">
<h2><a class="toc-backref" href="#id49" role="doc-backlink">Resources</a><a class="headerlink" href="#resources" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://www.codesimplicity.com/post/the-philosophy-of-testing/">The Philosophy of Testing</a></p>
<p><a class="reference external" href="http://blog.stevensanderson.com/2009/08/24/writing-great-unit-tests-best-and-worst-practises/">Writing Great Unit Tests: Best and Worst Practices</a></p>
<p><a class="reference external" href="https://www.philosophicalhacker.com/post/what-should-we-unit-test/">What Should We Unit Test?</a></p>
<p><a class="reference external" href="https://stackify.com/unit-testing-basics-best-practices/">Unit Testing Basics: Best Practices</a></p>
<p><a class="reference external" href="https://www.developer.com/mgmt/top-five-best-practices-for-writing-unit-test-scripts.html">Top Five Best Practices for Writing Unit Test Scripts</a></p>
<p><a class="reference external" href="https://msdn.microsoft.com/en-us/library/hh323702%28v=vs.100%29.aspx">General Service Testing Best Practices</a></p>
<p><a class="reference external" href="https://msdn.microsoft.com/en-us/library/hh323698%28v=vs.100%29.aspx">Integration Testing</a></p>
<p><a class="reference external" href="https://github.com/mawrkus/js-unit-testing-guide">JavaScript Unit Testing Guide (mawrkus)</a></p>
<p><a class="reference external" href="https://en.wikibooks.org/wiki/Ruby_Programming/Unit_testing">Ruby Programming: Unit Testing</a></p>
<p>McConnell, Steve. <em>Code Complete</em>. 2nd Edition. Microsoft Press, 2004.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">SuperCollider Wiki</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Contributing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../common/index.html">Common references</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Generating-crash-reports.html">Generating crash reports</a></li>
<li class="toctree-l3"><a class="reference internal" href="Setting-up-the-IDE-for-easy-contribution.html">Setting up the IDE for easy contribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="Setting-up-your-development-environment.html">Setting up your development environment</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Guide to SuperCollider Unit Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../The-wiki-wiki.html">The wiki-wiki</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UGen-Quality-Standards.html">UGen-Quality standards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Contributing</a><ul>
  <li><a href="index.html">Workflows</a><ul>
      <li>Previous: <a href="Setting-up-your-development-environment.html" title="previous chapter">Setting up your development environment</a></li>
      <li>Next: <a href="../The-wiki-wiki.html" title="next chapter">The wiki-wiki</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2024, SuperCollider.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/contributing/workflow/Unit-Testing-Guide.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>