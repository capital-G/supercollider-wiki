<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>scsynth development &#8212; SuperCollider Wiki  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=7d9986eb" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Code style guidelines" href="../style/index.html" />
    <link rel="prev" title="Project tasks organization" href="Project-tasks-organization.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="scsynth-development">
<h1>scsynth development<a class="headerlink" href="#scsynth-development" title="Link to this heading">¶</a></h1>
<p>This is a guide to the source code of the <code class="docutils literal notranslate"><span class="pre">scsynth</span></code> implementation of the SuperCollider audio server. Note that there is a newer implementation called <code class="docutils literal notranslate"><span class="pre">supernova</span></code>, which shares little source code with <code class="docutils literal notranslate"><span class="pre">scsynth</span></code> (only as far as the plugin and OSC interfaces are concerned).</p>
<p>This is the kind of documentation that could get out of date very quickly. None the less, it might give you a good overview of what does what where in the server. (btw. <a class="reference external" href="http://www.doxygen.org">http://www.doxygen.org</a> was pretty handy while figuring this stuff out)</p>
<section id="thread-structure">
<h2>Thread structure<a class="headerlink" href="#thread-structure" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Main Thread - <code class="docutils literal notranslate"><span class="pre">main()</span></code>, this thread blocks waiting on the quit semaphore after initializing the World, which starts the Audio Driver (Audio Thread and Audio Engine NRT Thread), and the Com Ports.</p></li>
<li><p>Com Port Thread(s) - one or more threads which listen for incoming OSC messages.</p></li>
<li><p>Audio Thread - pumped by host API audio callback</p></li>
<li><p>Audio Engine NRT (Non-Real-Time) Thread - launched by audio driver, blocks on a signal from the Audio Thread which is pumped at the end of each audio callback.</p></li>
<li><p>Disk I/O thread - launched by DiskIO_UGens.cpp, waits on <code class="docutils literal notranslate"><span class="pre">gDiskFifoHasData</span></code>, pumps <code class="docutils literal notranslate"><span class="pre">gDiskFifo</span></code> queue.</p></li>
</ul>
</section>
<section id="inter-thread-message-queues">
<h2>Inter-thread message queues<a class="headerlink" href="#inter-thread-message-queues" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Audio Thread -&gt; Audio Engine NRT Thread (<code class="docutils literal notranslate"><span class="pre">HiddenWorld::mTriggers</span></code>, <code class="docutils literal notranslate"><span class="pre">HiddenWorld::mNodeEnds</span></code>, <code class="docutils literal notranslate"><span class="pre">HiddenWorld::mDeleteGraphDefs</span></code>, <code class="docutils literal notranslate"><span class="pre">SC_CoreAudioDriver::mFromEngine</span></code>)</p></li>
<li><p>Audio Engine NRT Thread -&gt; Audio Thread (<code class="docutils literal notranslate"><span class="pre">SC_CoreAudioDriver::mToEngine</span></code> via <code class="docutils literal notranslate"><span class="pre">SC_SequencedCommand::CallNextStage()</span></code>)</p></li>
<li><p>Com Port Thread(s) -&gt; Audio Thread (via <code class="docutils literal notranslate"><span class="pre">ProcessOSCPacket()</span></code> call in <code class="docutils literal notranslate"><span class="pre">SC_TcpConnectionPort::Run()</span></code>, <code class="docutils literal notranslate"><span class="pre">SC_UdpInPort::Run()</span></code>, and <code class="docutils literal notranslate"><span class="pre">World_SendPacket</span></code>)</p></li>
<li><p>Audio Thread -&gt; Disk I/O thread (<code class="docutils literal notranslate"><span class="pre">DiskIn_next</span></code> and <code class="docutils literal notranslate"><span class="pre">DiskOut_next</span></code> post read and write requests to <code class="docutils literal notranslate"><span class="pre">gDiskFifo</span></code>)</p></li>
</ul>
</section>
<section id="file-descriptions">
<h2>File descriptions<a class="headerlink" href="#file-descriptions" title="Link to this heading">¶</a></h2>
<section id="headers-source-common">
<h3>[headers,source]/common/<a class="headerlink" href="#headers-source-common" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dfftlib.h</span></code></p>
<ul class="simple">
<li><p>prototypes for FFT functions (<code class="docutils literal notranslate"><span class="pre">d</span></code> for double, see also <code class="docutils literal notranslate"><span class="pre">fftlib.h</span></code>)</p>
<ul>
<li><p>no header guards (jmc says: borrowed code, not mine)</p></li>
</ul>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">dlfcn.h/dlopen.c</span></code></p>
<ul class="simple">
<li><p>Mac implementation of BSD <code class="docutils literal notranslate"><span class="pre">dlopen()</span></code>, <code class="docutils literal notranslate"><span class="pre">dlsym()</span></code>, <code class="docutils literal notranslate"><span class="pre">dlerror()</span></code>, <code class="docutils literal notranslate"><span class="pre">dlclose()</span></code> dynamic linking interface</p>
<ul>
<li><p>no header guards (jmc says: borrowed code, not mine)</p></li>
</ul>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">fftlib.h</span></code></p>
<ul class="simple">
<li><p>prototypes for FFT functions</p>
<ul>
<li><p>no header guards (jmc says: borrowed code, not mine)</p></li>
</ul>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_AllocPool.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_AllocPool.cpp</span></code></p>
<ul class="simple">
<li><p>A memory allocator, parameterised by functions which alocate and free “Areas” (pages).</p></li>
<li><p>World uses an AllocPool (stored in the HiddenWorld) to implement the so-called “real-time memory allocator”, a memory pool with a large initial size that is only used by the real-time thread. Used instead of malloc because malloc might take a mutex which cannot be allowed to happen in the audio callback.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Altivec.h</span></code></p>
<ul class="simple">
<li><p>altivec utility functions</p></li>
<li><p>defines USEVEC</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Endian.h</span></code></p>
<ul class="simple">
<li><p>checks that <code class="docutils literal notranslate"><span class="pre">BIG_ENDIAN</span></code> or <code class="docutils literal notranslate"><span class="pre">LITTLE_ENDIAN</span></code> is defined</p></li>
<li><p>includes or defines <code class="docutils literal notranslate"><span class="pre">htonl</span></code>, <code class="docutils literal notranslate"><span class="pre">htons</span></code>, <code class="docutils literal notranslate"><span class="pre">ntohl</span></code>, <code class="docutils literal notranslate"><span class="pre">ntohs</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Sem.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_Sem.cpp</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Semaphore</span><span class="p">{</span>
<span class="w">    </span><span class="n">Semaphore</span><span class="p">(</span><span class="w"> </span><span class="n">initialCount</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Aquire</span><span class="p">();</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Release</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Semaphore abstraction implemented using <code class="docutils literal notranslate"><span class="pre">pthreads</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_StringParser.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_StringParser.cpp</span></code></p>
<ul class="simple">
<li><p>String tokeniser parameterised by separator. <code class="docutils literal notranslate"><span class="pre">NextToken()</span></code> returns successive tokens. <code class="docutils literal notranslate"><span class="pre">SC_MAX_TOKEN_LENGTH</span></code> limits token length. Uses internal buffer to temporarily hold the returned token.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">scsynthsend.h</span></code>/<code class="docutils literal notranslate"><span class="pre">scsynthsend.cpp</span></code></p>
<ul class="simple">
<li><p>implements the <code class="docutils literal notranslate"><span class="pre">scpacket</span></code> class, a utility for constructing and and sending OSC packets</p></li>
<li><p>includes implementation of <code class="docutils literal notranslate"><span class="pre">makeSockAddr</span></code> which perhaps could be static</p></li>
<li><p>calls external functions <code class="docutils literal notranslate"><span class="pre">sendallto()</span></code> and mentions (but doesn’t use) <code class="docutils literal notranslate"><span class="pre">sendall()</span></code></p></li>
</ul>
</section>
<section id="headers-plugin-interface">
<h3>headers/plugin_interface/<a class="headerlink" href="#headers-plugin-interface" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">clz.h</span></code></p>
<ul class="simple">
<li><p>count leading zeros macro and derived functions</p></li>
<li><p>uses inline asm for count leading zeros instruction</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Hash.h</span></code></p>
<ul class="simple">
<li><p>inline hashing functions for strings and integers</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_BoundsMacros.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">abs</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code> and <code class="docutils literal notranslate"><span class="pre">clip</span></code> macros</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_BufGen.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BufGen</span></code> structure and function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BufGen_Create</span></code> function</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Constants.h</span></code></p>
<ul class="simple">
<li><p>math constants like <code class="docutils literal notranslate"><span class="pre">pi</span></code>, <code class="docutils literal notranslate"><span class="pre">2pi</span></code>, <code class="docutils literal notranslate"><span class="pre">log01</span></code> etc.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Dimension.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SC_Dimension</span></code> struct contains <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">numPixels</span></code>, <code class="docutils literal notranslate"><span class="pre">xslope</span></code>, <code class="docutils literal notranslate"><span class="pre">yslope</span></code></p></li>
<li><p>was used in SC3d5 on MacOS 9 for the image processing unit generators. Not used now (or yet).</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_FifoMsg.h</span></code></p>
<ul class="simple">
<li><p>Fifo message struct calls <code class="docutils literal notranslate"><span class="pre">Perform()</span></code> and <code class="docutils literal notranslate"><span class="pre">Free()</span></code> funcs, contains a data and a world ptr</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Graph.h</span></code></p>
<ul class="simple">
<li><p>graph structure</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_InlineBinaryOp.h</span></code></p>
<ul class="simple">
<li><p>optimized inline functions for common math and numeric operations</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_InlineUnaryOp.h</span></code></p>
<ul class="simple">
<li><p>optimized inline functions for common math and interpolation</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_InterfaceTable.h</span></code></p>
<ul class="simple">
<li><p>table of function pointers to World functions callable from plugins</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">sc_msg_iter.h</span></code></p>
<ul class="simple">
<li><p>implements <code class="docutils literal notranslate"><span class="pre">sc_msg_iter</span></code> class for parsing and decoding OSC packets</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Node.h</span></code></p>
<ul class="simple">
<li><p>node structure</p></li>
<li><p>see <code class="docutils literal notranslate"><span class="pre">source/server/SC_Node.cpp</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_PlugIn.h</span></code></p>
<ul class="simple">
<li><p>global include file for plugins, includes all other necessary include files</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Rate.h</span></code></p>
<ul class="simple">
<li><p>Rate struct containing values derived from rate such as inverses/radian rate etc.</p></li>
<li><p>see <code class="docutils literal notranslate"><span class="pre">source/server/SC_Rate.cpp</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_RGen.h</span></code></p>
<ul class="simple">
<li><p>Tausworthe PRNG implemented with inline functions</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_SndBuf.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SndBuf</span></code> struct and inline lookup functions</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Types.h</span></code></p>
<ul class="simple">
<li><p>basic type definitions such as <code class="docutils literal notranslate"><span class="pre">int8</span></code>, <code class="docutils literal notranslate"><span class="pre">uint8</span></code>, <code class="docutils literal notranslate"><span class="pre">int64</span></code> etc</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Unit.h</span></code></p>
<ul class="simple">
<li><p>unit structure and field accesor macros</p></li>
<li><p>see <code class="docutils literal notranslate"><span class="pre">source/server/SC_Unit.cpp</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Wire.h</span></code></p>
<ul class="simple">
<li><p>Wire structure</p></li>
<li><p>a Wire is a connection between unit generators</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_World.h</span></code></p>
<ul class="simple">
<li><p>plugin-visible World structure</p></li>
<li><p>contains constants and values used by plugins</p></li>
<li><p>contains pointer to <code class="docutils literal notranslate"><span class="pre">InterfaceTable</span></code></p></li>
<li><p>see <code class="docutils literal notranslate"><span class="pre">source/server/SC_World.cpp</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_WorldOptions.h</span></code></p>
<ul class="simple">
<li><p>structure containing parsed command line options</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Unroll.h</span></code></p>
<ul class="simple">
<li><p>macros and utilities for implementing optimized loops</p></li>
</ul>
</section>
<section id="headers-server">
<h3>headers/server/<a class="headerlink" href="#headers-server" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HashTable.h</span></code></p>
<ul class="simple">
<li><p>implementation of <code class="docutils literal notranslate"><span class="pre">HashTable</span></code> and <code class="docutils literal notranslate"><span class="pre">IntHashTable</span></code> container templates</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">IntFifo.h</span></code></p>
<ul class="simple">
<li><p>single reader, single writer, fixed length FIFO of ints template</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">MsgFifo.h</span></code></p>
<ul class="simple">
<li><p>message FIFO templates: <code class="docutils literal notranslate"><span class="pre">MsgFifo</span></code>, <code class="docutils literal notranslate"><span class="pre">MsgFifoNoFree</span></code> contains a fixed number of messages. Calls <code class="docutils literal notranslate"><span class="pre">Perform()</span></code> and <code class="docutils literal notranslate"><span class="pre">Free()</span></code> on enqueued messages.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">OSC_Packet.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OSC_Packet</span></code> structure, header data for an OSC packet</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">PriorityQueue.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PriorityQueue</span></code> container template</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ReadWriteMacros.h</span></code></p>
<ul class="simple">
<li><p>functions for reading and writing specified byte-ordered values to and from buffers and ansi FILEs</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_HiddenWorld.h</span></code></p>
<ul class="simple">
<li><p>global <code class="docutils literal notranslate"><span class="pre">gUnitDefLib</span></code> hash table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TriggerMsg</span></code>, <code class="docutils literal notranslate"><span class="pre">NodeEndMsg</span></code> and <code class="docutils literal notranslate"><span class="pre">DeleteGraphDefMsg</span></code> structs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HiddenWorld</span></code> struct contains data private to the <code class="docutils literal notranslate"><span class="pre">World</span></code> implementation</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_List.h</span></code></p>
<ul class="simple">
<li><p>doubly linked list container template</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Lock.h</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SC_Lock</span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Lock</span><span class="p">();</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Unlock</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SC_Lock</span></code> abstraction, wraps pthreads mutex</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Prototypes.h</span></code></p>
<ul class="simple">
<li><p>Prototypes for free functions pertaining to <code class="docutils literal notranslate"><span class="pre">World</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphDef</span></code>, <code class="docutils literal notranslate"><span class="pre">Graph</span></code>, <code class="docutils literal notranslate"><span class="pre">Node</span></code>, <code class="docutils literal notranslate"><span class="pre">Group</span></code>, <code class="docutils literal notranslate"><span class="pre">Unit</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Reply.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReplyAddress</span></code> struct and <code class="docutils literal notranslate"><span class="pre">SendReply</span></code> functions</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_SynthDef.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NodeDef</span></code> struct, extern <code class="docutils literal notranslate"><span class="pre">gGroupNodeDef</span></code></p></li>
<li><p>prototypes for <code class="docutils literal notranslate"><span class="pre">GroupNodeDef_Init</span></code> and <code class="docutils literal notranslate"><span class="pre">NodeDef_Dump</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_UnitSpec.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">UnitSpec</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_WireSpec.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">InputSpec</span></code>, <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">OutputSpec</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Rendezvous.h</span></code>/<code class="docutils literal notranslate"><span class="pre">Rendezvous.cpp</span></code></p>
<ul class="simple">
<li><p>function to publicize the SC server as a Rendezvous net service (calls <code class="docutils literal notranslate"><span class="pre">CFNetServiceCreate()</span></code>, <code class="docutils literal notranslate"><span class="pre">CFNetServiceRegister</span></code>).</p></li>
</ul>
</section>
<section id="headers-server-sc-samp-h">
<h3>headers/server/SC_Samp.h<a class="headerlink" href="#headers-server-sc-samp-h" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>prototypes and global wavetables as defined in <code class="docutils literal notranslate"><span class="pre">Samp.cpp</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Samp.cpp</span></code></p>
<ul class="simple">
<li><p>more or less duplicated in lang</p></li>
<li><p>global sine wavetables: <code class="docutils literal notranslate"><span class="pre">gSine</span></code>, <code class="docutils literal notranslate"><span class="pre">gPMSine</span></code>, <code class="docutils literal notranslate"><span class="pre">gInvSine</span></code>, <code class="docutils literal notranslate"><span class="pre">gSineWavetable</span></code></p></li>
<li><p>implements <code class="docutils literal notranslate"><span class="pre">SignalAsWavetable()</span></code>/<code class="docutils literal notranslate"><span class="pre">WavetableAsSignal()</span></code> which encode wavetables in some interesting way</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_BufGen.cpp</span></code></p>
<ul class="simple">
<li><p>implements <code class="docutils literal notranslate"><span class="pre">BufGen_Create()</span></code> which hashes the gen name and creates a new <code class="docutils literal notranslate"><span class="pre">BufGen</span></code> object (binding a <code class="docutils literal notranslate"><span class="pre">BufGen</span></code> function) and registers it by calling <code class="docutils literal notranslate"><span class="pre">AddBufGen</span></code> (implemented in <code class="docutils literal notranslate"><span class="pre">SC_World.cpp</span></code>)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Carbon.cpp</span></code></p>
<ul class="simple">
<li><p>implements <code class="docutils literal notranslate"><span class="pre">HasAltivec()</span></code> using Carbon Gestalt, comment asks how to implement on Linux.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Complex.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_Complex.cpp</span></code></p>
<ul class="simple">
<li><p>classes <code class="docutils literal notranslate"><span class="pre">Polar</span></code> and <code class="docutils literal notranslate"><span class="pre">Complex</span></code> with conversion functions. Global lookup tables <code class="docutils literal notranslate"><span class="pre">gMagLUT</span></code>, <code class="docutils literal notranslate"><span class="pre">gPhaseLUT</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_ComPort.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_ComPort.cpp</span></code></p>
<ul class="simple">
<li><p>NOTE: this is different from the implementation in lang (although many of the differences are questionable)</p></li>
<li><p>OSC socket listeners / dispatchers</p></li>
<li><p>implements <code class="docutils literal notranslate"><span class="pre">CmdPort</span></code> hierarchy including <code class="docutils literal notranslate"><span class="pre">ComPort</span></code>, <code class="docutils literal notranslate"><span class="pre">SC_TcpConnectionPort</span></code>, <code class="docutils literal notranslate"><span class="pre">SC_TcpInPort</span></code>, <code class="docutils literal notranslate"><span class="pre">SC_UdpInPort</span></code></p></li>
<li><p>when Start()ed these classes create a new thread and run a loop waiting for new messages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SC_TcpInPort</span></code> listens on a TCP socket and creates a new SC_TcpConnectionPort to handle requests on a connection</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SC_UdpInPort</span></code> and <code class="docutils literal notranslate"><span class="pre">SC_TcpConnectionPort</span></code> listen for OSC messages and send them to <code class="docutils literal notranslate"><span class="pre">ProcessOSCPacket(packet)</span></code></p></li>
<li><p>contains comment about potential delete this; crash</p></li>
<li><p>implements <code class="docutils literal notranslate"><span class="pre">World_SendPacket</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_CoreAudio.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_CoreAudio.cpp</span></code></p>
<ul class="simple">
<li><p>defines <code class="docutils literal notranslate"><span class="pre">SC_AudioDriver</span></code> base struct (seems to not contain everything it should)</p></li>
<li><p>implements interface to audio driver (CoreAudio, JACK)</p></li>
<li><p>implements engine functionality (pumps queues, calls the World to generate audio)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Dimension.cpp</span></code></p>
<ul class="simple">
<li><p>initialization function for <code class="docutils literal notranslate"><span class="pre">SC_Dimension</span></code> struct (perhaps could be a class but isn’t)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Errors.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_Errors.cpp</span></code></p>
<ul class="simple">
<li><p>error code enumeration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SC_ErrorString()</span></code> - converts error codes to strings</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Graph.cpp</span></code></p>
<ul class="simple">
<li><p>implements functions of <code class="docutils literal notranslate"><span class="pre">SC_Graph</span></code> struct</p></li>
<li><p>is a <code class="docutils literal notranslate"><span class="pre">Node</span></code></p></li>
<li><p>a tree of Nodes</p></li>
<li><p>a Graph is a leaf node (Groups are internal nodes).</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_GraphDef.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_GraphDef.cpp</span></code></p>
<ul class="simple">
<li><p>implements function of <code class="docutils literal notranslate"><span class="pre">SC_GraphDef</span></code> struct (could be a class?)</p></li>
<li><p>Prototype for a Graph</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Group.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_Group.cpp</span></code></p>
<ul class="simple">
<li><p>is a <code class="docutils literal notranslate"><span class="pre">Node</span></code></p></li>
<li><p>a linked list of Nodes which are executed in order</p></li>
<li><p>Groups are internal nodes.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">headers/server/SC_Lib.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SC_NamedObj</span></code> class, <code class="docutils literal notranslate"><span class="pre">GetKey()</span></code> and <code class="docutils literal notranslate"><span class="pre">GetHash()</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">source/server/SC_Lib.cpp</span></code></p>
<ul class="simple">
<li><p>utility functions for sending /done /fail and /late OSC packets</p></li>
<li><p>implementation of <code class="docutils literal notranslate"><span class="pre">NamedObject</span></code></p></li>
<li><p>implementation of <code class="docutils literal notranslate"><span class="pre">SC_LibCommand</span></code> (Command pattern wrapper for function ptr with exception -&gt; error result conversion).</p></li>
<li><p>implements <code class="docutils literal notranslate"><span class="pre">NewCommand</span></code> function which registers the commands with <code class="docutils literal notranslate"><span class="pre">gCmdLib</span></code> and <code class="docutils literal notranslate"><span class="pre">gCmdArray</span></code> - with a name or command number. this seems to be for calling <code class="docutils literal notranslate"><span class="pre">LibCommands</span></code> from OSC</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">headers/server/SC_Lib_Cintf.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">SC_LibCmd</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gCmdLib</span></code> hash table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gCmdArray</span></code> command array</p></li>
<li><p>command number enumerations</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">source/server/SC_Lib_Cintf.cpp</span></code></p>
<ul class="simple">
<li><p>implements <code class="docutils literal notranslate"><span class="pre">initalize_library()</span></code> function which creates <code class="docutils literal notranslate"><span class="pre">gCmdLib</span></code>, <code class="docutils literal notranslate"><span class="pre">gUnitDefLib</span></code>, <code class="docutils literal notranslate"><span class="pre">gBufGenLib</span></code>, <code class="docutils literal notranslate"><span class="pre">gPlugInCmds</span></code></p></li>
<li><p>iterates plugins in the plugin directory</p></li>
<li><p>calls each plugins <code class="docutils literal notranslate"><span class="pre">_load</span></code> function.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_MiscCmds.cpp</span></code></p>
<ul class="simple">
<li><p>implementation and registration of many server commands</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Node.cpp</span></code></p>
<ul class="simple">
<li><p>implementation of Node functions</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Rate.cpp</span></code></p>
<ul class="simple">
<li><p>Rate struct initializer - calculates derived values from sample rate and buffer size</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_SequencedCommand.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_SequencedCommand.cpp</span></code></p>
<ul class="simple">
<li><p>implements <code class="docutils literal notranslate"><span class="pre">SC_SequencedCommand</span></code> and subclasses <code class="docutils literal notranslate"><span class="pre">BufGenCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufAllocCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufShmAllocCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufFreeCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufCloseCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufZeroCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufAllocReadCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufReadCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">BufWriteCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">AudioQuitCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">AudioStatusCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">NotifyCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">LoadSynthDefCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">RecvSynthDefCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">LoadSynthDefDirCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">SendReplyCmd</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SequencedCommands</span></code> execute in up to four stages Stage1(), Stage2(), Stage3(), Stage4()</p></li>
<li><p>from the header file:
Having SequencedCommands allows performing actions that might otherwise require taking a mutex, which is undesirable in a real time thread.
Some commands require several stages of processing at both the real time and non real time levels. This class does the messaging between levels for you so that you only need to write the functions.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Str4.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_Str4.cpp</span></code></p>
<ul class="simple">
<li><p>4-byte aligned and zero padded string functions</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_SyncCondition.h</span></code>/<code class="docutils literal notranslate"><span class="pre">SC_SyncCondition.cpp</span></code></p>
<ul class="simple">
<li><p>implements <code class="docutils literal notranslate"><span class="pre">SC_SyncCondition</span></code>, and implementation of a condition variable synchronization primitive</p></li>
<li><p>uses <code class="docutils literal notranslate"><span class="pre">pthread</span></code> <code class="docutils literal notranslate"><span class="pre">pthread_cond_t</span></code> and <code class="docutils literal notranslate"><span class="pre">pthread_mutex_t</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_Unit.cpp</span></code></p>
<ul class="simple">
<li><p>Unit struct functions</p></li>
<li><p>includes <code class="docutils literal notranslate"><span class="pre">Unit_New</span></code> which initializes a Unit from a UnitSpec</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">headers/server/SC_UnitDef.h</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">PlugInCmd</span></code>, <code class="docutils literal notranslate"><span class="pre">UnitCmd</span></code> and <code class="docutils literal notranslate"><span class="pre">UnitDef</span></code></p></li>
<li><p>prototypes for <code class="docutils literal notranslate"><span class="pre">UnitDef_Create</span></code>, <code class="docutils literal notranslate"><span class="pre">UnitDef_AddCmd</span></code> and <code class="docutils literal notranslate"><span class="pre">PlugIn_DefineCmd</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">source/server/SC_UnitDef.cpp</span></code></p>
<ul class="simple">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">UnitDef</span></code></p></li>
<li><p>functions for registering PlugIn and Unit commands</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SC_World.cpp</span></code></p>
<ul class="simple">
<li><p>implementation of the World object, the top level SC server object. World is basically a container for the various buses, queues, hash tables and buffers. The world contains the top Group. World creates an <code class="docutils literal notranslate"><span class="pre">SC_CoreAudioDriver</span></code> to perform the realtime synthesis. Implementation details of SC_World which are not visible to plugins are stored in the <code class="docutils literal notranslate"><span class="pre">HiddenWorld</span></code> structure.</p></li>
<li><p>offline synthesis</p></li>
<li><p>initializer for struct <code class="docutils literal notranslate"><span class="pre">InterfaceTable</span></code></p></li>
<li><p>free function wrappers for:</p></li>
<li><p>memory allocation in the World’s pool</p></li>
<li><p>hashing, registering and removing world graph defs</p></li>
<li><p>hashing, registering and removing unit defs</p></li>
<li><p>hashing, registering and removing buf gens</p></li>
<li><p>hashing, registering and removing plugin cmds</p></li>
<li><p>hashing, adding, removing and looking up Nodes, Graphs and Groups
. note that all of the above overload <code class="docutils literal notranslate"><span class="pre">GetKey</span></code> and <code class="docutils literal notranslate"><span class="pre">GetHash</span></code> based on parameter type</p></li>
<li><p>some sample format detection functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Perform()</span></code> implementations for <code class="docutils literal notranslate"><span class="pre">TriggerMsg</span></code>, <code class="docutils literal notranslate"><span class="pre">NodeEndMsg</span></code>, <code class="docutils literal notranslate"><span class="pre">DeleteGraphDefMsg</span></code></p></li>
<li><p>implementation of <code class="docutils literal notranslate"><span class="pre">NotifyNoArgs()</span></code></p></li>
<li><p>implementation of free func <code class="docutils literal notranslate"><span class="pre">SendMsgToEngine()</span></code>, <code class="docutils literal notranslate"><span class="pre">SendMsgFromEngine()</span></code></p></li>
<li><p>implementation of <code class="docutils literal notranslate"><span class="pre">SetPrintFunc</span></code> and <code class="docutils literal notranslate"><span class="pre">scprintf()</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">scsynth_main.cpp</span></code></p>
<ul class="simple">
<li><p>parse command line options into <code class="docutils literal notranslate"><span class="pre">WorldOptions</span></code> struct, detect missing args</p></li>
<li><p>create <code class="docutils literal notranslate"><span class="pre">World</span></code> instance</p></li>
<li><p>open UDP and TCP listeners if requested</p></li>
<li><p>call <code class="docutils literal notranslate"><span class="pre">World_WaitForQuit</span></code> to execute</p></li>
</ul>
</section>
<section id="source-plugins">
<h3>source/plugins<a class="headerlink" href="#source-plugins" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">SCComplex.c</span></code>/<code class="docutils literal notranslate"><span class="pre">SCComplex.h</span></code></p>
<ul class="simple">
<li><p>Note these are not the same as <code class="docutils literal notranslate"><span class="pre">SC_Complex.[c,h]</span></code> in the server</p></li>
<li><p>Defines <code class="docutils literal notranslate"><span class="pre">SCComplex</span></code> and <code class="docutils literal notranslate"><span class="pre">SCPolar</span></code> structs.</p></li>
<li><p>It is questionable whether these files and the ones used by the server (<code class="docutils literal notranslate"><span class="pre">SC_Complex.[c,h]</span></code>) should be different.</p></li>
</ul>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">SuperCollider Wiki</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../git/index.html">Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../meetings/index.html">Meetings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/index.html">Miscellaneous dev notes</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Project structure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Continuous-integration%3A-GitHub-Actions.html">CI: GitHub Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="Continuous-integration%3A-Travis-and-Appveyor.html">CI: Travis and AppVeyor</a></li>
<li class="toctree-l3"><a class="reference internal" href="Miscellaneous-project-information-%28CI%2C-maintenance-scripts%2C-etc.%29.html">Miscellaneous project information</a></li>
<li class="toctree-l3"><a class="reference internal" href="Notes-for-refactoring-the-server-implementation.html">Refactoring the server implementatin</a></li>
<li class="toctree-l3"><a class="reference internal" href="Project-Structure.html">Project directions</a></li>
<li class="toctree-l3"><a class="reference internal" href="Project-directions.html">Project directions</a></li>
<li class="toctree-l3"><a class="reference internal" href="Project-tasks-organization.html">Project tasks organization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">scsynth development</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../style/index.html">Code style guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/index.html">Plattforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releasing/index.html">Releasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reviewing/index.html">Reviewing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Development</a><ul>
  <li><a href="index.html">Project structure</a><ul>
      <li>Previous: <a href="Project-tasks-organization.html" title="previous chapter">Project tasks organization</a></li>
      <li>Next: <a href="../style/index.html" title="next chapter">Code style guidelines</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2024, SuperCollider.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/development/project-structure/scsynth-development.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>